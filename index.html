<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Helldivers 2 - Estratagemas</title>
<style>
  body{margin:0;font-family:Arial, sans-serif;background:#111;color:#fff;}
  header{background:#222;padding:10px;text-align:right;display:flex;justify-content:space-between;align-items:center;}
  #toggleMenu{background:#444;color:#fff;border:none;padding:10px 20px;font-size:1.1em;cursor:pointer;border-radius:8px;}
  
  /* Bot√≥n de borrar */
  #clearButton {
    background:#444;
    color:#fff;
    border:none;
    width: 44px;
    height: 44px;
    font-size:1.3em;
    cursor:pointer;
    border-radius:8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 10px;
    opacity: 0.5;
    transition: opacity 0.2s;
  }
  
  #clearButton.active {
    opacity: 1;
  }

  /* Panel lateral */
  #menu{position:fixed;top:0;left:0;height:100%;width:90%;max-width:400px;background:#1a1a1a;overflow-y:auto;transform:translateX(0);transition:transform .3s ease;padding:20px;z-index:9999;}
  #menu.hide{transform:translateX(-100%);}
  .menu-header{display:flex;justify-content:space-between;align-items:center;}

  /* Botones cuadrados en el header del men√∫ */
  .menu-buttons {
    display: flex;
    gap: 10px;
  }
  
  .square-btn {
    width: 44px;
    height: 44px;
    background:#444;
    border:none;
    color:#fff;
    font-size:1.3em;
    cursor:pointer;
    border-radius:8px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
  }

  h2{margin-top:20px;border-bottom:1px solid #444;padding-bottom:5px;cursor:pointer;}
  .cat-content{margin-top:10px;display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:12px;}
  .cat-content.hide{display:none;}

  /* Estratagema cuadro con borde claro y fondo oscuro */
  .estratagema{cursor:pointer;background:#1f1f1f;border:3px solid #aaa;border-radius:8px;padding:8px;display:flex;justify-content:center;align-items:center;transition:background .15s,transform .08s;}
  .estratagema:hover{background:#2c2c2c;transform:scale(1.05);}
  .estratagema img.icon{width:70px;height:70px;object-fit:cover;border-radius:4px;}

  /* Zona principal - ESCRITORIO */
  #seleccionadas{margin:20px auto;max-width:1200px;display:grid;gap:20px;padding:20px;grid-template-columns: repeat(1, 1fr);}
  .card{background:#222;border-radius:10px;padding:10px;box-shadow:0 0 8px #000;display:flex;flex-direction:column;align-items:flex-start;}
  .fila{width:100%;display:flex;align-items:center;justify-content:space-between;gap:15px;}
  .fila img.arrow{width:36px;height:36px;margin:0 2px;}
  .nombre{margin-top:8px;font-size:1.1em;font-weight:bold;width:100%;text-align:left;}

  /* Modal idioma */
  #langModal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;z-index:10000;}
  #langModal .box{background:#222;padding:18px;border-radius:12px;text-align:center;}
  #langModal button{margin:8px;padding:10px 18px;font-size:1.05em;cursor:pointer;border:none;border-radius:8px;background:#444;color:white;}
  #langModal .note{font-size:0.9em;color:#ccc;margin-top:8px;}
   /* === Espacio extra al final del panel lateral === */
  #categorias::after {
    content: "";
    display: block;
    height: 60px;   /* agrega 60px de "aire" despu√©s de la √∫ltima categor√≠a */
  }

  /* Media queries para M√ìVIL */
  @media (max-width: 768px) {
    #seleccionadas {
      grid-template-columns: repeat(1, 1fr);
      gap: 15px;
      padding: 15px;
    }
    
    /* Cuando hay m√°s de 5 tarjetas en m√≥vil */
    #seleccionadas.mas-de-5 {
      grid-template-columns: repeat(2, 1fr);
      max-width: 100%;
    }
    
    /* Estilo para m√≥vil cuando hay m√°s de 5 tarjetas */
    #seleccionadas.mas-de-5 .card {
      flex-direction: column;
      align-items: center;
      padding: 8px;
    }
    
    #seleccionadas.mas-de-5 .fila {
      flex-direction: column;
      gap: 8px;
    }
    
    #seleccionadas.mas-de-5 .fila img:first-child {
      width: 50px;
      height: 50px;
    }
    
    #seleccionadas.mas-de-5 .nombre {
      display: none; /* Ocultamos el nombre en m√≥vil cuando hay m√°s de 5 */
    }
    
    #seleccionadas.mas-de-5 .fila img.arrow {
      width: 24px;
      height: 24px;
    }
    
    /* Ocultar tarjetas m√°s all√° de las primeras 10 en m√≥vil */
    #seleccionadas.mas-de-5 .card:nth-child(n+11) {
      display: none;
    }
  }
</style>
</head>
<body>
<header>
  <button id="clearButton" title="Eliminar todas las estratagemas" aria-label="Eliminar todas las estratagemas">üóëÔ∏è</button>
  <button id="toggleMenu">‚ò∞ Estratagemas</button>
</header>

<!-- Modal idioma -->
<div id="langModal" role="dialog" aria-modal="true">
  <div class="box">
    <h2>Choose Language / Elige Idioma</h2>
    <div>
      <button data-lang="en" id="btnEn">üá∫üá∏ English</button>
      <button data-lang="es" id="btnEs">üá™üá∏ Espa√±ol</button>
    </div>
  </div>
</div>

<!-- Panel -->
<div id="menu" aria-hidden="false">
  <div class="menu-header">
    <h1 id="menuTitle">Selecciona Estratagemas</h1>
    <div class="menu-buttons">
      <button class="square-btn" id="closeMenu">‚ò∞</button>
      <button class="square-btn" id="reopenLang">üåê</button>
    </div>
  </div>
  <div id="categorias"></div>
</div>

<main id="seleccionadas" aria-live="polite"></main>

<script>
document.addEventListener('DOMContentLoaded', ()=>{

  const arrowImgs = {
    up:   "https://static.wikia.nocookie.net/helldivers_gamepedia/images/5/51/Up_Arrow.png",
    down: "https://static.wikia.nocookie.net/helldivers_gamepedia/images/1/13/Down_Arrow.png",
    left: "https://static.wikia.nocookie.net/helldivers_gamepedia/images/4/4e/Left_Arrow.png",
    right:"https://static.wikia.nocookie.net/helldivers_gamepedia/images/3/3c/Right_Arrow.png"
  };

  let estratagemas = [];   // cargado por fetch
  let currentLang = 'es';

  // refs
  const langModal = document.getElementById('langModal');
  const btnEn = document.getElementById('btnEn');
  const btnEs = document.getElementById('btnEs');  
  const reopenLang = document.getElementById('reopenLang');
  const menu = document.getElementById('menu');
  const categoriasDiv = document.getElementById('categorias');
  const seleccionadas = document.getElementById('seleccionadas');
  const toggleMenu = document.getElementById('toggleMenu');
  const closeMenu = document.getElementById('closeMenu');
  const clearButton = document.getElementById('clearButton'); // Bot√≥n de limpiar

  // listeners del modal (seguro)
  btnEn.addEventListener('click', ()=> chooseLang('en'));
  btnEs.addEventListener('click', ()=> chooseLang('es'));  
  reopenLang.addEventListener('click', ()=> { langModal.style.display = 'flex'; });
  toggleMenu.addEventListener('click', ()=> menu.classList.toggle('hide'));
  closeMenu.addEventListener('click', ()=> menu.classList.add('hide')); // Cerrar men√∫ desde dentro
  clearButton.addEventListener('click', clearAllSelections); // Limpiar selecciones

  // ayuda: cerrar modal con Escape
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape') {
      if(langModal.style.display === 'flex') langModal.style.display = 'none';
      else menu.classList.add('hide'); // Tambi√©n cerrar men√∫ con Escape
    }
  });

  // funcion escoger idioma
  function chooseLang(lang){
    currentLang = lang;
    langModal.style.display = 'none';
    
    // Actualizar texto del bot√≥n de men√∫
    updateMenuButtonText();
    
    // actualiza textos si ya hay menu; si no, renderMenu() lo har√° tras cargar datos
    if(estratagemas.length) renderMenu();
    updateSelectedNames(); // actualiza tarjetas ya creadas
    console.log('Idioma cambiado a', currentLang);
  }

  // Actualizar texto del bot√≥n de men√∫ seg√∫n idioma
  function updateMenuButtonText() {
    toggleMenu.textContent = '‚ò∞ ' + (currentLang === 'en' ? 'Stratagems' : 'Estratagemas');
  }

  // Limpiar todas las selecciones
  function clearAllSelections() {
    if (seleccionadas.children.length === 0) return;
    
    seleccionadas.innerHTML = '';
    updateGridColumns();
    updateClearButtonState();
  }

  // Actualizar estado del bot√≥n de limpiar
  function updateClearButtonState() {
    if (seleccionadas.children.length > 0) {
      clearButton.classList.add('active');
      clearButton.title = currentLang === 'en' ? 'Clear all stratagems' : 'Eliminar todas las estratagemas';
    } else {
      clearButton.classList.remove('active');
    }
  }

  // Cargar JSON (puedes cambiar a tu URL raw de GitHub)
  async function cargarEstratagemas() {
    try {
      // Cambia la ruta si usas GitHub: const url = 'https://raw.githubusercontent.com/USUARIO/REPO/main/estratagemas.json';
      const url = 'https://raw.githubusercontent.com/Kart0/HD2-STRATAGEMS/refs/heads/main/estratagemas.json';
      const res = await fetch(url);
      if(!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
      estratagemas = await res.json();
      console.log('Estratagemas cargadas:', estratagemas.length);
      renderMenu();
    } catch (err) {
      console.error('Error cargando estratagemas.json:', err);
      // deja modal abierto para que el usuario pueda elegir Continuar
      // si prefieres auto-cerrar, podr√≠as cerrar aqu√≠
    }
  }

  // Render lateral en grid
  function renderMenu(){
    categoriasDiv.innerHTML = '';
    document.getElementById('menuTitle').textContent = currentLang === 'en' ? 'Select Stratagems' : 'Selecciona Estratagemas';

    // Agrupar por categor√≠a (usamos key combinada para conservar en/es)
    const grupos = {}; // key: "en||es" -> { en:..., es:..., items:[] }
    estratagemas.forEach(item=>{
      const en = item.category.en || item.category['en'] || '';
      const es = item.category.es || item.category['es'] || '';
      const key = en + '||' + es;
      if(!grupos[key]) grupos[key] = { en, es, items: [] };
      grupos[key].items.push(item);
    });

    // Para mantener un orden predecible, puedes definir un orden espec√≠fico:
    const desiredOrder = [
      'MISSION||MISI√ìN',   // en||es
      'OFFENSIVE||OFENSIVAS',
      'SUPPLY||SUMINISTROS',
      'DEFENSIVE||DEFENSIVAS'
    ];
    // crear lista de keys en orden (si existen)
    const keysOrdered = [];
    desiredOrder.forEach(k=> { if(grupos[k]) keysOrdered.push(k); });
    // a√±adir cualquier otra categor√≠a que no est√© en desiredOrder
    Object.keys(grupos).forEach(k=>{ if(!keysOrdered.includes(k)) keysOrdered.push(k); });

    // construir html
    keysOrdered.forEach(key=>{
      const group = grupos[key];
      if(!group) return;
      const catDiv = document.createElement('div');
      catDiv.className = 'categoria';

      const header = document.createElement('h2');
      header.className = 'cat-header';
      // Guardamos ambos nombres en data attributes
      header.dataset.en = group.en;
      header.dataset.es = group.es;
      header.textContent = (currentLang === 'en' ? group.en : group.es) + ' ‚ñæ';

      const content = document.createElement('div');
      content.className = 'cat-content';

      // cada item como cuadro solo imagen
      group.items.forEach(it=>{
        const box = document.createElement('div');
        box.className = 'estratagema';
        box.dataset.id = it.id;
        box.dataset.en = it.name.en;
        box.dataset.es = it.name.es;
        box.dataset.img = it.image;
        box.dataset.combo = (it.combo || []).join(',');

        const img = document.createElement('img');
        img.className = 'icon';
        img.src = it.image;
        img.alt = it.name[currentLang] || it.name.en || it.name.es || '';
        box.appendChild(img);

        // al click a√±adimos/removemos tarjeta por id
        box.addEventListener('click', ()=> toggleCardById(it.id));

        content.appendChild(box);
      });

      // plegar/desplegar
      header.addEventListener('click', ()=>{
        content.classList.toggle('hide');
        const isHidden = content.classList.contains('hide');
        header.textContent = (currentLang === 'en' ? group.en : group.es) + (isHidden ? ' ‚ñ∏' : ' ‚ñæ');
      });

      catDiv.appendChild(header);
      catDiv.appendChild(content);
      categoriasDiv.appendChild(catDiv);
    });
  }

  function updateGridColumns(){
    const total = seleccionadas.children.length;
    
    // Actualizar estado del bot√≥n de limpiar
    updateClearButtonState();
    
    // Para m√≥viles: aplicar clases especiales cuando hay m√°s de 5 elementos
    if (window.innerWidth <= 768) {
      if (total > 5) {
        seleccionadas.classList.add('mas-de-5');
        seleccionadas.style.gridTemplateColumns = 'repeat(2, 1fr)';
      } else {
        seleccionadas.classList.remove('mas-de-5');
        seleccionadas.style.gridTemplateColumns = 'repeat(1, 1fr)';
      }
    } else {
      // Para escritorio: mantener la l√≥gica original
      seleccionadas.classList.remove('mas-de-5');
      const cols = Math.max(1, Math.ceil(total / 5));
      seleccionadas.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    }
  }

  // A√±ade o quita tarjeta en zona principal por id
  function toggleCardById(id){
    const item = estratagemas.find(x => x.id === id);
    if(!item){
      console.warn('No se encontr√≥ estratagema con id', id);
      return;
    }

    const existing = seleccionadas.querySelector(`.card[data-id="${CSS.escape(id)}"]`);
    if(existing){ 
        existing.remove();
        updateGridColumns();   // üîë recalcular tambi√©n al quitar
        return;
    }

    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.id = id;

    const fila = document.createElement('div');
    fila.className = 'fila';

    const icon = document.createElement('img');
    icon.src = item.image;
    icon.width = 60; icon.height = 60;
    icon.alt = item.name[currentLang] || item.name.en || item.name.es || '';

    const arrows = document.createElement('div');
    (item.combo || []).forEach(dir=>{
      const a = document.createElement('img');
      a.className = 'arrow';
      const src = arrowImgs[dir] || arrowImgs[dir.toLowerCase()] || '';
      a.src = src;
      a.alt = dir;
      arrows.appendChild(a);
    });

    fila.appendChild(icon);
    fila.appendChild(arrows);

    const nombreDiv = document.createElement('div');
    nombreDiv.className = 'nombre';
    nombreDiv.textContent = item.name[currentLang] || item.name.en || item.name.es || '';

    card.appendChild(fila);
    card.appendChild(nombreDiv);
    seleccionadas.appendChild(card);

    updateGridColumns();       // üîë recalcular al agregar
  }

  // Cuando cambia idioma, actualizar nombres de tarjetas ya creadas
  function updateSelectedNames(){
    if(!estratagemas.length) return;
    document.querySelectorAll('#seleccionadas .card').forEach(card=>{
      const id = card.dataset.id;
      const info = estratagemas.find(x => x.id === id);
      if(info){
        const nuevo = info.name[currentLang] || info.name.en || info.name.es;
        const nombreDiv = card.querySelector('.nombre');
        if(nombreDiv) nombreDiv.textContent = nuevo;
        // alt del icon tambi√©n:
        const icon = card.querySelector('img');
        if(icon) icon.alt = info.name[currentLang] || icon.alt;
      }
    });
  }

  // A√±adir listener para redimensionamiento de ventana
  window.addEventListener('resize', updateGridColumns);

  // iniciar carga
  cargarEstratagemas();

  // Debug helper: bot√≥n "Continuar" cierra el modal si fetch falla (ya a√±adido)
  console.log('Interfaz lista ‚Äî abre la consola (F12) si algo no carga.');

});
</script>
</body>
</html>